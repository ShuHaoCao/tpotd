<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è¯çµ¡äººç·¨è¼¯å™¨</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      background-color: #f0f0f0;
      padding: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .editor, .output {
      flex: 1 1 500px;
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    .form-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }
    .form-group label {
      font-size: 0.9em;
      display: block;
      margin-bottom: 2px;
    }
    .form-group input {
      width: 100%;
      padding: 5px;
      font-size: 0.9em;
    }
    button {
      margin-top: 10px;
      padding: 8px 12px;
      background-color: #1976d2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .entry {
      background: #eef;
      padding: 10px;
      margin-top: 10px;
      border-left: 4px solid #2196f3;
    }
    .entry button {
      margin-right: 5px;
    }
    .edit-btn { background-color: #ff9800; }
    .delete-btn { background-color: #e53935; }
    pre {
      background: #222;
      color: #eee;
      padding: 10px;
      border-radius: 6px;
      white-space: pre-wrap;
      font-size: 0.85em;
    }
    .file-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
    }
  </style>
</head>
<body>

<div class="editor">
  <h2>è¯çµ¡äººç·¨è¼¯å™¨</h2>
  <div class="form-grid">
    <div class="form-group"><label>åç¨±</label><input id="nameInput" type="text"></div>
    <div class="form-group"><label>æ‰‹æ©Ÿ</label><input id="mobileInput" type="text"></div>
    <div class="form-group"><label>ç¶²è·¯é›»è©±</label><input id="voipInput" type="text"></div>
    <div class="form-group"><label>å¸‚è©±</label><input id="landlineInput" type="text"></div>
    <div class="form-group" style="grid-column: span 4;"><label>å‚™è¨»</label><input id="noteInput" type="text"></div>
  </div>

  <button id="submitBtn" onclick="submitEntry()">æ–°å¢</button>
  <button id="cancelBtn" onclick="cancelEdit()" style="display:none;background-color:#999;">å–æ¶ˆç·¨è¼¯</button>

  <div class="file-actions">
    <label>ğŸ“¥ è¼‰å…¥ JSONï¼š<input type="file" accept=".json" onchange="importJSON(event)"></label>
    <button onclick="exportJSON()">ğŸ“¤ åŒ¯å‡º JSON</button>
  </div>

  <h3>è³‡æ–™åˆ—è¡¨</h3>
  <div id="entryList"></div>
</div>

<div class="output">
  <h2>JSON é è¦½ï¼ˆå¯è¤‡è£½ï¼‰</h2>
  <pre id="jsonPreview">[]</pre>
</div>

<script>
  let contacts = [];
  let isEditing = false;
  let editingIndex = -1;

  function refreshList() {
    const list = document.getElementById("entryList");
    list.innerHTML = "";
    contacts.forEach((item, index) => {
      const div = document.createElement("div");
      div.className = "entry";
      div.innerHTML = `<b>${item.åç¨±}</b><br>ğŸ“± ${item.æ‰‹æ©Ÿ}ï½œğŸ“¶ ${item.ç¶²è·¯é›»è©±}ï½œâ˜ ${item.å¸‚è©±}<br>ğŸ“ ${item.å‚™è¨»}
        <br><button class="edit-btn" onclick="startEdit(${index})">âœï¸ ç·¨è¼¯</button>
        <button class="delete-btn" onclick="deleteEntry(${index})">ğŸ—‘ï¸ åˆªé™¤</button>`;
      list.appendChild(div);
    });
    document.getElementById("jsonPreview").textContent = JSON.stringify(contacts, null, 2);
  }

  function getFormData() {
    return {
      "åç¨±": document.getElementById("nameInput").value.trim(),
      "æ‰‹æ©Ÿ": document.getElementById("mobileInput").value.trim(),
      "ç¶²è·¯é›»è©±": document.getElementById("voipInput").value.trim(),
      "å¸‚è©±": document.getElementById("landlineInput").value.trim(),
      "å‚™è¨»": document.getElementById("noteInput").value.trim()
    };
  }

  function setFormData(data) {
    document.getElementById("nameInput").value = data.åç¨±;
    document.getElementById("mobileInput").value = data.æ‰‹æ©Ÿ;
    document.getElementById("voipInput").value = data.ç¶²è·¯é›»è©±;
    document.getElementById("landlineInput").value = data.å¸‚è©±;
    document.getElementById("noteInput").value = data.å‚™è¨»;
  }

  function clearForm() {
    document.querySelectorAll("input").forEach(input => input.value = "");
  }

  function submitEntry() {
    const entry = getFormData();
    if (!entry.åç¨±) {
      alert("è«‹å¡«å¯«åç¨±");
      return;
    }
    if (isEditing) {
      contacts[editingIndex] = entry;
      isEditing = false;
      editingIndex = -1;
      document.getElementById("submitBtn").textContent = "æ–°å¢";
      document.getElementById("cancelBtn").style.display = "none";
    } else {
      contacts.push(entry);
    }
    clearForm();
    refreshList();
  }

  function startEdit(index) {
    setFormData(contacts[index]);
    isEditing = true;
    editingIndex = index;
    document.getElementById("submitBtn").textContent = "æ›´æ–°";
    document.getElementById("cancelBtn").style.display = "inline-block";
  }

  function cancelEdit() {
    isEditing = false;
    editingIndex = -1;
    clearForm();
    document.getElementById("submitBtn").textContent = "æ–°å¢";
    document.getElementById("cancelBtn").style.display = "none";
  }

  function deleteEntry(index) {
    if (confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†è¯çµ¡äººï¼Ÿ")) {
      contacts.splice(index, 1);
      refreshList();
    }
  }

  function importJSON(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        const json = JSON.parse(e.target.result);
        if (Array.isArray(json)) {
          contacts = json;
          refreshList();
        } else {
          alert("JSON æ ¼å¼éŒ¯èª¤ï¼Œå¿…é ˆç‚ºé™£åˆ—ï¼");
        }
      } catch {
        alert("è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¢ºèª JSON æ ¼å¼ï¼");
      }
    };
    reader.readAsText(file);
  }

  function exportJSON() {
    const blob = new Blob([JSON.stringify(contacts, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "contacts.json";
    a.click();
    URL.revokeObjectURL(url);
  }

  refreshList();
</script>

</body>
</html>
