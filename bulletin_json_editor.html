<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¸ƒå‘Šæ¬„JSONç·¨è¼¯å™¨</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      padding: 20px;
      background-color: #f7f7f7;
    }

    .editor, .output {
      flex: 1 1 400px;
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }

    label, select, input, textarea {
      display: block;
      width: 100%;
      margin-top: 10px;
      font-size: 1em;
    }

    textarea {
      height: 80px;
    }

    button {
      margin-top: 10px;
      padding: 8px 12px;
      background-color: #1976d2;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .entry {
      margin: 10px 0;
      padding: 10px;
      background: #eef;
      border-left: 4px solid #2196f3;
    }

    .entry button {
      margin-right: 5px;
    }

    .edit-btn { background-color: #ff9800; }
    .delete-btn { background-color: #e53935; }

    pre {
      white-space: pre-wrap;
      background: #222;
      color: #eee;
      padding: 10px;
      border-radius: 5px;
      overflow-x: auto;
    }

    .file-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-top: 15px;
    }
  </style>
</head>
<body>

<div class="editor">
  <h2>å¸ƒå‘Šæ¬„JSONç·¨è¼¯å™¨</h2>

  <label>åˆ†é¡</label>
  <select id="category">
    <option value="shift">ç­è¡¨ç•°å‹•</option>
    <option value="important">é‡è¦äº‹é …</option>
    <option value="policy">æ”¿ä»¤å®£å°</option>
  </select>

  <label>æ—¥æœŸï¼š</label>
  <input type="text" id="dateInput" placeholder="ä¾‹ï¼š113/06/14">

  <label>æ¨™é¡Œï¼š</label>
  <input type="text" id="titleInput" placeholder="è«‹è¼¸å…¥æ¨™é¡Œ">

  <label>å…§å®¹ï¼š</label>
  <textarea id="contentInput" placeholder="è«‹è¼¸å…¥å…§å®¹"></textarea>

  <button id="submitBtn" onclick="submitEntry()">æ–°å¢</button>
  <button id="cancelBtn" onclick="cancelEdit()" style="display:none;background-color:#999;">å–æ¶ˆç·¨è¼¯</button>

  <div class="file-actions">
    <label>ğŸ“¥ è¼‰å…¥ JSONï¼š
      <input type="file" accept=".json" onchange="importJSON(event)">
    </label>
    <button onclick="exportJSON()">ğŸ“¤ åŒ¯å‡º JSON</button>
  </div>

  <h3>ç¾æœ‰è³‡æ–™</h3>
  <div id="entryList"></div>
</div>

<div class="output">
  <h2>JSON é è¦½ï¼ˆå¯æ‰‹å‹•è¤‡è£½ï¼‰</h2>
  <pre id="jsonPreview">{}</pre>
</div>

<script>
  let bulletin = {
    "shift": [],
    "important": [],
    "policy": []
  };

  let isEditing = false;
  let editingIndex = -1;
  let editingCategory = "";

  function refreshList() {
    const category = document.getElementById("category").value;
    const list = document.getElementById("entryList");
    list.innerHTML = "";

    bulletin[category].forEach((item, index) => {
      const div = document.createElement("div");
      div.className = "entry";
      div.innerHTML = `<b>${item.date}</b> - ${item.title}<br>${item.content}
        <br>
        <button class="edit-btn" onclick="startEdit('${category}', ${index})">âœï¸ ç·¨è¼¯</button>
        <button class="delete-btn" onclick="deleteEntry('${category}', ${index})">ğŸ—‘ï¸ åˆªé™¤</button>`;
      list.appendChild(div);
    });

    document.getElementById("jsonPreview").textContent = JSON.stringify(bulletin, null, 2);
  }

  function submitEntry() {
    const category = document.getElementById("category").value;
    const date = document.getElementById("dateInput").value.trim();
    const title = document.getElementById("titleInput").value.trim();
    const content = document.getElementById("contentInput").value.trim();

    if (!date || !title || !content) {
      alert("è«‹å®Œæ•´å¡«å¯«æ‰€æœ‰æ¬„ä½ï¼");
      return;
    }

    if (isEditing) {
      bulletin[editingCategory][editingIndex] = { date, title, content };
      isEditing = false;
      editingIndex = -1;
      document.getElementById("submitBtn").textContent = "æ–°å¢";
      document.getElementById("cancelBtn").style.display = "none";
    } else {
      bulletin[category].push({ date, title, content });
    }

    document.getElementById("dateInput").value = "";
    document.getElementById("titleInput").value = "";
    document.getElementById("contentInput").value = "";
    refreshList();
  }

  function startEdit(category, index) {
    const entry = bulletin[category][index];
    document.getElementById("category").value = category;
    document.getElementById("dateInput").value = entry.date;
    document.getElementById("titleInput").value = entry.title;
    document.getElementById("contentInput").value = entry.content;

    isEditing = true;
    editingIndex = index;
    editingCategory = category;

    document.getElementById("submitBtn").textContent = "æ›´æ–°";
    document.getElementById("cancelBtn").style.display = "inline-block";
  }

  function cancelEdit() {
    isEditing = false;
    editingIndex = -1;
    document.getElementById("submitBtn").textContent = "æ–°å¢";
    document.getElementById("cancelBtn").style.display = "none";

    document.getElementById("dateInput").value = "";
    document.getElementById("titleInput").value = "";
    document.getElementById("contentInput").value = "";
  }

  function deleteEntry(category, index) {
    if (confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†è³‡æ–™å—ï¼Ÿ")) {
      bulletin[category].splice(index, 1);
      refreshList();
    }
  }

  function importJSON(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        const json = JSON.parse(e.target.result);
        if (json.shift && json.important && json.policy) {
          bulletin = json;
          cancelEdit();
          refreshList();
        } else {
          alert("åŒ¯å…¥å¤±æ•—ï¼šæª”æ¡ˆçµæ§‹ä¸æ­£ç¢ºï¼");
        }
      } catch (err) {
        alert("ç„¡æ³•è§£æ JSON æª”æ¡ˆï¼");
      }
    };
    reader.readAsText(file);
  }

  function exportJSON() {
    const blob = new Blob([JSON.stringify(bulletin, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "bulletin.json";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }

  refreshList();
</script>

</body>
</html>
