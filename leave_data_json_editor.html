<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å€‹äººä¼‘å‡è³‡æ–™JSONç·¨è¼¯å™¨</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      background-color: #f0f0f0;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      padding: 20px;
    }

    .editor, .output {
      flex: 1 1 500px;
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }

    .form-group label {
      font-size: 0.85em;
    }

    .form-group input {
      width: 100%;
      padding: 4px;
      font-size: 0.85em;
      text-align: right;
    }

    .form-group input[type="text"] {
      text-align: left;
    }

    button {
      margin-top: 10px;
      padding: 8px 12px;
      background-color: #1976d2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .entry {
      background: #eef;
      padding: 10px;
      margin-top: 10px;
      border-left: 4px solid #2196f3;
      font-size: 0.9em;
    }

    .entry button {
      margin-right: 5px;
    }

    .edit-btn { background-color: #ff9800; }
    .delete-btn { background-color: #e53935; }

    pre {
      background: #222;
      color: #eee;
      padding: 10px;
      border-radius: 6px;
      white-space: pre-wrap;
      font-size: 0.85em;
    }

    .file-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
    }

    input[type="file"] {
      font-size: 0.85em;
    }
  </style>
</head>
<body>

<div class="editor">
  <h2>å€‹äººä¼‘å‡è³‡æ–™JSONç·¨è¼¯å™¨</h2>

  <div class="form-grid">
    <div class="form-group"><label>ä»£è™Ÿ</label><input id="idInput" type="text"></div>
    <div class="form-group"><label>å§“å</label><input id="nameInput" type="text"></div>
    <div class="form-group"><label>1-5æœˆè¼ªä¼‘å¤©æ•¸</label><input id="pastInput" type="number" step="0.1"></div>
    <div class="form-group"><label>6æœˆè¼ªä¼‘å¤©æ•¸</label><input id="nowInput" type="number" step="0.1"></div>
    <div class="form-group"><label>è¼ªä¼‘å®Œæˆåº¦(%)</label><input id="rateInput" type="text"></div>
    <div class="form-group"><label>æ ¸å®šè¼ªä¼‘å¤©æ•¸</label><input id="approveInput" type="number" step="0.1"></div>
    <div class="form-group"><label>å·²ä¼‘è¼ªä¼‘å¤©æ•¸</label><input id="usedInput" type="number" step="0.1"></div>
    <div class="form-group"><label>å‰©é¤˜è¼ªä¼‘å¤©æ•¸</label><input id="remainInput" type="number" step="0.1"></div>
    <div class="form-group"><label>ä¸Šæœˆç©æ¬ å…¬ä¼‘</label><input id="prevInput" type="number" step="0.1"></div>
    <div class="form-group"><label>æœ¬æœˆè£œä¼‘å¤©æ•¸</label><input id="makeupInput" type="number" step="0.1"></div>
    <div class="form-group"><label>å‰©é¤˜ç©æ¬ å…¬ä¼‘</label><input id="remainLeaveInput" type="number" step="0.1"></div>
  </div>

  <button id="submitBtn" onclick="submitEntry()">æ–°å¢</button>
  <button id="cancelBtn" onclick="cancelEdit()" style="display:none;background-color:#999;">å–æ¶ˆç·¨è¼¯</button>

  <div class="file-actions">
    <label>ğŸ“¥ è¼‰å…¥ JSONï¼š<input type="file" accept=".json" onchange="importJSON(event)"></label>
    <button onclick="exportJSON()">ğŸ“¤ åŒ¯å‡º JSON</button>
  </div>

  <h3>è³‡æ–™åˆ—è¡¨</h3>
  <div id="entryList"></div>
</div>

<div class="output">
  <h2>JSON é è¦½ï¼ˆå¯è¤‡è£½ï¼‰</h2>
  <pre id="jsonPreview">{}</pre>
</div>

<script>
  let leaveData = {};
  let isEditing = false;
  let editingKey = "";

  function refreshList() {
    const list = document.getElementById("entryList");
    list.innerHTML = "";
    Object.keys(leaveData).forEach(key => {
      const item = leaveData[key];
      const div = document.createElement("div");
      div.className = "entry";
      div.innerHTML = `<b>${key}</b> - ${item.name}ï½œæ¯”ä¾‹ï¼š${item.rate}ï½œæ ¸å®šï¼š${item.approve}
        <br>
        <button class="edit-btn" onclick="startEdit('${key}')">âœï¸ ç·¨è¼¯</button>
        <button class="delete-btn" onclick="deleteEntry('${key}')">ğŸ—‘ï¸ åˆªé™¤</button>`;
      list.appendChild(div);
    });
    document.getElementById("jsonPreview").textContent = JSON.stringify(leaveData, null, 2);
  }

  function getFormData() {
    return {
      name: document.getElementById("nameInput").value.trim(),
      past: parseFloat(document.getElementById("pastInput").value) || 0,
      now: parseFloat(document.getElementById("nowInput").value) || 0,
      rate: document.getElementById("rateInput").value.trim() || "",
      approve: parseFloat(document.getElementById("approveInput").value) || 0,
      used: parseFloat(document.getElementById("usedInput").value) || 0,
      remain: parseFloat(document.getElementById("remainInput").value) || 0,
      prev: parseFloat(document.getElementById("prevInput").value) || 0,
      makeup: parseFloat(document.getElementById("makeupInput").value) || 0,
      remainLeave: parseFloat(document.getElementById("remainLeaveInput").value) || 0
    };
  }

  function setFormData(id, data) {
    document.getElementById("idInput").value = id;
    document.getElementById("nameInput").value = data.name;
    document.getElementById("pastInput").value = data.past;
    document.getElementById("nowInput").value = data.now;
    document.getElementById("rateInput").value = data.rate;
    document.getElementById("approveInput").value = data.approve;
    document.getElementById("usedInput").value = data.used;
    document.getElementById("remainInput").value = data.remain;
    document.getElementById("prevInput").value = data.prev;
    document.getElementById("makeupInput").value = data.makeup;
    document.getElementById("remainLeaveInput").value = data.remainLeave;
  }

  function clearForm() {
    document.querySelectorAll("input").forEach(input => {
      if (input.type !== "file") input.value = "";
    });
  }

  function submitEntry() {
    const id = document.getElementById("idInput").value.trim();
    if (!id) return alert("è«‹è¼¸å…¥ ID");
    const newData = getFormData();
    if (!newData.name) return alert("è«‹è¼¸å…¥å§“å");

    leaveData[id] = newData;
    isEditing = false;
    editingKey = "";
    clearForm();
    refreshList();
    document.getElementById("submitBtn").textContent = "æ–°å¢";
    document.getElementById("cancelBtn").style.display = "none";
  }

  function startEdit(id) {
    setFormData(id, leaveData[id]);
    isEditing = true;
    editingKey = id;
    document.getElementById("submitBtn").textContent = "æ›´æ–°";
    document.getElementById("cancelBtn").style.display = "inline-block";
  }

  function cancelEdit() {
    isEditing = false;
    editingKey = "";
    clearForm();
    document.getElementById("submitBtn").textContent = "æ–°å¢";
    document.getElementById("cancelBtn").style.display = "none";
  }

  function deleteEntry(id) {
    if (confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†è³‡æ–™ï¼Ÿ")) {
      delete leaveData[id];
      refreshList();
    }
  }

  function importJSON(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        const json = JSON.parse(e.target.result);
        leaveData = json;
        refreshList();
        cancelEdit();
      } catch (err) {
        alert("ç„¡æ³•è§£æ JSON æª”æ¡ˆï¼");
      }
    };
    reader.readAsText(file);
  }

  function exportJSON() {
    const blob = new Blob([JSON.stringify(leaveData, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "leave_data.json";
    a.click();
    URL.revokeObjectURL(url);
  }

  refreshList();
</script>

</body>
</html>