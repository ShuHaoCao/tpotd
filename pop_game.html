<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>å£“åŠ›å¤§ä½œæˆ° - æˆ°è¡“ç‰ˆ</title>
    <style>
      :root {
        --bg: #f5f6fa;
      }
      body {
        margin: 0;
        padding: 0;
        background: var(--bg);
        overflow: hidden;
        font-family: sans-serif;
        touch-action: manipulation;
      }
      #game-container {
        position: relative;
        width: 100vw;
        height: 100vh;
      }
      #hud {
        position: absolute;
        top: 20px;
        width: 100%;
        display: flex;
        justify-content: space-around;
        z-index: 10;
        pointer-events: none;
      }
      .stat-box {
        background: #fff;
        padding: 10px 20px;
        border-radius: 30px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        font-weight: bold;
      }

      .bubble {
        position: absolute;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.1s;
        animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }
      @keyframes popIn {
        from {
          transform: scale(0);
        }
        to {
          transform: scale(1);
        }
      }

      /* ç•«é¢é–ƒçˆç‰¹æ•ˆ (é»åˆ°ç´…è‰²æˆ–ç´«è‰²æ™‚è§¸ç™¼) */
      .flash-red {
        animation: flashRed 0.3s;
      }
      @keyframes flashRed {
        from {
          background: rgba(255, 0, 0, 0.3);
        }
        to {
          background: transparent;
        }
      }
      .flash-purple {
        animation: flashPurple 0.5s;
      }
      @keyframes flashPurple {
        from {
          background: rgba(162, 0, 255, 0.4);
        }
        to {
          background: transparent;
        }
      }

      #overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.95);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 100;
        text-align: center;
      }
      button {
        padding: 15px 40px;
        font-size: 20px;
        background: #2f3640;
        color: #fff;
        border: none;
        border-radius: 50px;
      }
    </style>
  </head>
  <body>
    <div id="game-container">
      <div id="hud">
        <div class="stat-box">â± <span id="time">30</span>s</div>
        <div class="stat-box">ğŸ’° <span id="score">0</span></div>
      </div>

      <div id="overlay">
        <h1>è¾¦å…¬å®¤æˆ°è¡“æ¶ˆé™¤</h1>
        <p>ğŸ”´ç´…è‰²æ‰£åˆ† | ğŸŸ£ç´«è‰²æ¸…å ´ | ğŸŸ¡é‡‘è‰²åŠ çˆ†</p>
        <button onclick="startGame()">é–‹å§‹æˆ°é¬¥</button>
      </div>
    </div>

    <script>
      let score = 0;
      let timeLeft = 30;
      let gameActive = false;
      let spawnTimer, clockTimer;

      const container = document.getElementById("game-container");
      const scoreEl = document.getElementById("score");
      const timeEl = document.getElementById("time");
      const overlay = document.getElementById("overlay");

      // æ³¡æ³¡é…ç½®
      const types = [
        { id: "g1", size: 40, color: "#44bd32", pts: 10, label: "å°" },
        { id: "g2", size: 70, color: "#44bd32", pts: 20, label: "ä¸­" },
        { id: "g3", size: 100, color: "#44bd32", pts: 40, label: "å¤§" },
        { id: "bad", size: 140, color: "#c23616", pts: -50, label: "æ‰£åˆ†!" },
        { id: "gold", size: 25, color: "#fbc531", pts: 100, label: "VIP" },
        { id: "bomb", size: 0, color: "#9c88ff", pts: 50, label: "BOOM" }, // ç´«è‰²ç‚¸å½ˆ
      ];

      function startGame() {
        score = 0;
        timeLeft = 30;
        gameActive = true;
        scoreEl.innerText = score;
        overlay.style.display = "none";

        spawnTimer = setInterval(spawnBubble, 450);
        clockTimer = setInterval(() => {
          timeLeft--;
          timeEl.innerText = timeLeft;
          if (timeLeft <= 0) endGame();
        }, 1000);
      }

      function spawnBubble() {
        if (!gameActive) return;

        // ç´«è‰²æ³¡æ³¡æª¢æŸ¥ï¼šç•«é¢ä¸Šæ˜¯å¦å·²æœ‰ç´«è‰²
        const hasPurple = document.querySelector(".bubble-bomb");

        let rand = Math.random() * 100;
        let type;
        if (rand < 15 && !hasPurple)
          type = types[5]; // ç´«è‰²ç‚¸å½ˆ (15% ä¸”å”¯ä¸€)
        else if (rand < 25)
          type = types[4]; // é‡‘è‰² (10%)
        else if (rand < 40)
          type = types[3]; // ç´…è‰² (15%)
        else if (rand < 60)
          type = types[2]; // å¤§ç¶ 
        else if (rand < 80)
          type = types[1]; // ä¸­ç¶ 
        else type = types[0]; // å°ç¶ 

        createBubble(type);
      }

      function createBubble(type) {
        const b = document.createElement("div");
        const size = type.id === "bomb" ? Math.random() * 60 + 40 : type.size;

        b.className = `bubble bubble-${type.id}`;
        b.style.width = b.style.height = size + "px";
        b.style.backgroundColor = type.color;
        b.innerText = type.label;

        const x = Math.random() * (window.innerWidth - size - 20) + 10;
        const y = Math.random() * (window.innerHeight - size - 150) + 80;
        b.style.left = x + "px";
        b.style.top = y + "px";

        const clickHandler = (e) => {
          e.preventDefault();
          if (!gameActive) return;

          if (type.id === "bomb") {
            triggerBomb();
          } else {
            updateScore(type.pts);
            if (type.pts < 0) flashScreen("red");
          }
          b.remove();
        };

        b.addEventListener("touchstart", clickHandler);
        b.addEventListener("mousedown", clickHandler);
        container.appendChild(b);

        // è‡ªå‹•æ¶ˆå¤± (ç´«è‰²å­˜åœ¨ä¹…ä¸€é»ï¼Œç´…è‰²æ¶ˆå¤±å¿«ä¸€é»å¢åŠ é›£åº¦)
        let duration = 2000;
        if (type.id === "bad") duration = 1200;
        if (type.id === "bomb") duration = 4000;

        setTimeout(() => {
          if (b.parentNode) b.remove();
        }, duration);
      }

      function triggerBomb() {
        flashScreen("purple");
        const allBubbles = document.querySelectorAll(".bubble");
        let count = allBubbles.length;
        updateScore(50 + count * 5); // åŸºç¤50åˆ† + æ¸…æ‰ä¸€å€‹æ³¡æ³¡åŠ 5åˆ†
        allBubbles.forEach((b) => b.remove());
        if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
      }

      function updateScore(pts) {
        score += pts;
        scoreEl.innerText = score;
        if (navigator.vibrate) navigator.vibrate(pts < 0 ? 100 : 20);
      }

      function flashScreen(type) {
        const f = document.createElement("div");
        f.style.position = "fixed";
        f.style.top = 0;
        f.style.left = 0;
        f.style.width = "100vw";
        f.style.height = "100vh";
        f.style.pointerEvents = "none";
        f.style.zIndex = 5;
        f.className = `flash-${type}`;
        document.body.appendChild(f);
        setTimeout(() => f.remove(), 500);
      }

      function endGame() {
        gameActive = false;
        clearInterval(spawnTimer);
        clearInterval(clockTimer);

        // æ¸…é™¤ç•«é¢ä¸Šå‰©é¤˜çš„æ³¡æ³¡
        document.querySelectorAll(".bubble").forEach((b) => b.remove());

        // --- 10 éšé ­éŠœé‚è¼¯ ---
        let rank = "";
        let rankColor = "";

        if (score <= 200) {
          rank = "è¾¦å…¬å®¤é€æ˜äºº ğŸ˜¶";
          rankColor = "#94a3b8";
        } else if (score <= 400) {
          rank = "èŒ¶æ°´é–“å¸¸å®¢ â˜•";
          rankColor = "#8ed1fc";
        } else if (score <= 600) {
          rank = "æ€¥ä»¶è™•ç†å“¡ ğŸ“„";
          rankColor = "#0693e3";
        } else if (score <= 800) {
          rank = "è³‡æ·±æ‰“å­—æ©Ÿ âŒ¨ï¸";
          rankColor = "#00d084";
        } else if (score <= 1000) {
          rank = "å°ˆæ¡ˆæ•‘ç«éšŠ ğŸ‘¨â€ğŸš’";
          rankColor = "#7bdcb5";
        } else if (score <= 1200) {
          rank = "éƒ¨é–€é ‚æ¨‘æŸ± ğŸ›ï¸";
          rankColor = "#abb8c3";
        } else if (score <= 1400) {
          rank = "æ•ˆç‡å®ˆè­·ç¥ ğŸ›¡ï¸";
          rankColor = "#f78da7";
        } else if (score <= 1600) {
          rank = "å‰¯ç¸½ç¶“ç†é å‚™è» ğŸ“ˆ";
          rankColor = "#ff6900";
        } else if (score <= 1800) {
          rank = "å‚³å¥‡ç¸½ç¶“ç† ğŸ‘‘";
          rankColor = "#fcb900";
        } else {
          rank = "è·¨åœ‹é›†åœ˜åŸ·è¡Œé•· ğŸ’";
          rankColor = "#eb144c";
        }

        // é¡¯ç¤ºçµç®—ç•«é¢
        overlay.style.display = "flex";
        overlay.innerHTML = `
        <h1 style="color:#2d3436">æ™‚é–“åˆ°ï¼</h1>
        <div style="font-size: 1.2rem; color: #636e72;">æœ€çµ‚å¾—åˆ†</div>
        <div style="font-size: 4rem; font-weight: 900; color: #2d3436; margin: 10px 0;">${score}</div>
        <div style="background: ${rankColor}; color: white; padding: 10px 25px; border-radius: 50px; font-size: 1.5rem; font-weight: bold; margin-bottom: 30px; box-shadow: 0 4px 15px ${rankColor}66;">
            ${rank}
        </div>
        <button onclick="startGame()" style="cursor:pointer; padding: 15px 50px; font-size: 1.2rem; background: #2d3436; color: white; border: none; border-radius: 50px;">
            å†æˆ°ä¸€å›
        </button>
    `;
      }
    </script>
  </body>
</html>
