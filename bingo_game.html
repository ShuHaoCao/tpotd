<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>ç¾¤æ˜Ÿå¤§äº‚é¬¥è³“æœ</title>
    <style>
      :root {
        --primary-color: #3498db;
        --secondary-color: #e67e22;
        --bg-color: #f4f7f6;
        --cell-size: 50px;
      }

      @media (max-width: 600px) {
        :root {
          --cell-size: 44px;
        }
        .game-container {
          flex-direction: column;
          align-items: center;
        }
        .board-wrapper {
          width: 95%;
          max-width: 320px;
        }
      }

      body {
        font-family: "PingFang TC", "Microsoft JhengHei", sans-serif;
        background: var(--bg-color);
        margin: 0;
        padding: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      #message-box {
        width: 90%;
        max-width: 450px;
        margin: 10px 0;
        padding: 15px;
        background: #2c3e50;
        color: white;
        border-radius: 15px;
        font-size: 1.1rem;
        text-align: center;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        min-height: 1.5em;
      }

      .controls {
        margin-bottom: 15px;
      }
      .btn-reset {
        padding: 10px 25px;
        font-size: 1rem;
        font-weight: bold;
        background: var(--secondary-color);
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        box-shadow: 0 4px 0 #d35400;
        transition: 0.1s;
      }
      .btn-reset:active {
        transform: translateY(3px);
        box-shadow: none;
      }

      .game-container {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        justify-content: center;
        width: 100%;
      }

      .board-wrapper {
        background: white;
        padding: 12px;
        border-radius: 15px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        text-align: center;
        border-top: 6px solid #ccc;
        transition: 0.3s;
      }
      .board-wrapper.active {
        border-top-color: var(--primary-color);
        transform: translateY(-5px);
        background: #fff;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      }

      h2 {
        margin: 5px 0;
        font-size: 0.95rem;
        color: #34495e;
        white-space: nowrap;
      }

      .board {
        display: grid;
        grid-template-columns: repeat(5, var(--cell-size));
        grid-gap: 5px;
        margin: 10px auto;
      }

      .cell {
        width: var(--cell-size);
        height: var(--cell-size);
        display: flex;
        align-items: center;
        justify-content: center;
        background: #ecf0f1;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        color: #2c3e50;
        -webkit-tap-highlight-color: transparent;
      }
      .cell.marked {
        background: #ff4757;
        color: white;
        animation: pop 0.3s;
      }

      @keyframes pop {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
        }
        100% {
          transform: scale(1);
        }
      }
      .npc-board .cell {
        cursor: default;
      }
      .status {
        margin-top: 8px;
        font-weight: bold;
        color: #7f8c8d;
        font-size: 0.85rem;
      }
    </style>
  </head>
  <body>
    <div id="message-box">ğŸ‘‹ æ­¡è¿ä¾†åˆ°è³“æœå¤§è³½</div>

    <div class="controls">
      <button class="btn-reset" onclick="resetGame()">â™»ï¸ é‡æ–°é…å°å°æ‰‹</button>
    </div>

    <div class="game-container">
      <div id="wrapper-0" class="board-wrapper active">
        <h2 id="title-0">ç©å®¶:ä½ (ä½¿ç”¨è€…)</h2>
        <div id="board-0" class="board"></div>
        <div id="status-0" class="status">é€£ç·šæ•¸: 0</div>
      </div>
      <div id="wrapper-1" class="board-wrapper">
        <h2 id="title-1">ç©å®¶:è¼‰å…¥ä¸­(NPC)</h2>
        <div id="board-1" class="board npc-board"></div>
        <div id="status-1" class="status">é€£ç·šæ•¸: 0</div>
      </div>
      <div id="wrapper-2" class="board-wrapper">
        <h2 id="title-2">ç©å®¶:è¼‰å…¥ä¸­(NPC)</h2>
        <div id="board-2" class="board npc-board"></div>
        <div id="status-2" class="status">é€£ç·šæ•¸: 0</div>
      </div>
    </div>

    <script>
      const WIN_LINES = 5;
      const funnyNames = [
        "é¦¬æ–¯å…‹æ‹‰",
        "é»ƒä»å‹³åˆ°å®¶",
        "è³ˆä¼¯æ–¯æ–¯",
        "è”¡ä¾æ—æ™‚æŠ±ä½›è…³",
        "å‘¨æ°å€«æµè½‰",
        "ç„¡æ³•é¡¯ç¤ºäººç‰©åç¨±",
        "éŠ…é‘¼ç£æ‰›å ±ç´™",
        "æ±—å‘³æˆ°è­¦",
        "å·¦é’é¾å³èƒ–è™",
        "éˆè»Šç”©å°¾æ£ºæé£›",
        "åª½ä½ çœ‹çˆ¸åœ¨é£›",
        "é ­èšŠå­å®",
        "ç´…è¡£å°ç”·å­©",
        "ä¹é ­é¾é–ƒåˆ°è…°",
        "å–„è§£äººè¡£",
        "å‰›å¥½äº”å€‹å­—",
        "æ‰“æ­»æˆ‘ä¹Ÿä¸",
        "æˆ‘å¾ˆæœƒå°„",
        "åª½åª½ä¾†äº†å¿«é—œé›»è…¦",
        "æ€ªå¾ˆå¼·æˆ‘å…ˆèµ°",
        "å·®ä¸€å…ƒè²·å¤šå¤š",
        "èªªå¥½ä¸æ‰“è‡‰",
        "ä¸è¦å•ä½ æœƒæ€•",
        "æ‹‰éŠè£¡çš„çŒ›ç¸",
        "ä½ çœ‹ä¸è¦‹æˆ‘",
        "è½‰è§’é‡åˆ°æ€ª",
        "ä½ é»åˆ°æˆ‘äº†",
        "ç¶²è·¯é€£ç·šä¸­æ–·",
        "æ‹¿ä½›ç ç ¸è€¶ç©Œ",
        "ä½ å·²ç¶“æ­»äº†",
        "ç¶ æ²¹ç²¾é»çœ¼ç›",
        "å±äº¡ç­†è¨˜æœ¬",
        "é—œå®Œå¤§å“¥é—œäºŒå“¥",
        "æ”¾å±çµ¦ä½ è",
        "ä½ åœ¨å¤§è²ä»€éº¼å•¦",
        "è’™å¥‡Dèƒ½å…’",
        "åå­å‰›å¥½ä¸ƒå€‹å­",
        "è‹—æ —å°äº”éƒ",
        "AIäººå·¥æ™ºéšœ",
        "æ”¾å±çµ¦ä½ è",
        "è’™å…¶Dç½©æ¯",
        "è€å…¬æˆ‘è¦ç¡¬æ¼¢",
        "è€çˆºä¸å¯ä»¥",
        "å¤«äººæœƒç”Ÿæ°£",
        "å”å”ä¸å¯ä»¥",
        "çˆºçˆºä¸å¯ä»¥",
        "æ‚²å‚·æ»·è‚‰é£¯",
        "æ†‚é¬±è‚‰ç‡¥é£¯",
        "æŠ’æƒ…æ§è‚‰é£¯",
        "è¢«å†°å¡Šç‡™å‚·",
        "éº»è¾£ç™½é–‹æ°´",
        "æ¶¼éºµè¶ç†±åƒ",
        "æ¢å±±ä¼¯ä½é™°å®…",
        "æ¢å±±ä¼¯æè‹±å°",
        "æ–æ»¾è§€ä¸–éŸ³",
        "å°¾ç”°è³€ä¸€èˆª",
        "æ—æ­£è‹±å¤§æ³•å¸«",
        "å‹•æ„Ÿé˜¿åŒ¹å©†",
        "å°¼å¤æ¸…åéƒ",
        "å›§æŠŠåˆ€",
        "é¾äº”å¿«æ’¿æ§",
        "è€¶ç©Œæ¿€å‡¸",
        "å±±ä¸‹æ™ºå›§",
        "è»Ÿä»Šå¤©",
        "éµæ‹³ç„¡æ•µå­«ä¸­å±±",
        "å†ä¸–éœ¸ç‹è¢ä¸–å‡±",
        "å¤©é­”å‚³äººæ¯›æ¾¤æ±",
        "ç©¿æ—åŒ—è…¿è”£ä¸­æ­£",
        "æœ¨æ‘å€’é ­å“‰",
        "é­šç¥¥æ‹³",
        "æ¹¯å§†å—‘åå¸",
        "å”ä¼¯è™é›»èšŠé¦™",
        "é†‰æ‹³ç”˜ä¹ƒè¿ª",
        "å®‡æ™ºæ³¢å¤šé‡çµè¡£",
        "é„§ä¸éº—å›",
        "é­”å°å°‘å¹´æ—é»˜å¨˜",
        "å¤§ä¿ æ„›åƒæ¼¢å ¡å ¡",
        "å¸¸å¨æ‰“ä¾†ç¦",
        "åƒå±åƒå¾—å¥½é–‹å¿ƒ",
        "æˆ‘è¦æ‰“åå€‹",
        "é­”é¬¼ç­‹è‚‰äºº",
        "é–ƒé›»äº”é¨å£«",
        "ä¹ä¸ä¸­çš„éœ¸ä¸»",
        "ä¸‰é‡åŠ‰å¾·è¯",
        "æ‰“æˆ‘å•Šç¬¨è›‹",
        "çœ‹è¦‹ä¾†ç¦å’¬å¸¸å¨",
        "è¦ä½ å‘½ä¸‰åƒ",
        "æ²¹ç‚¸åŒ…é¾æ˜Ÿ",
        "èª å¯¦è±†æ²™åŒ…",
        "å¥¶æ²¹è¡€æ»´å­",
        "é™æ§é›»æµé¦™è•‰",
        "æ…šæ„§æ£’æ£’ç³–",
        "ç´…ç‡’é›ç¿…è†€",
        "æˆ‘æ„›ä¸€æ¢æŸ´",
        "å«ç¬‘åŠæ­¥ç™²",
        "ä¸€æ—¥å–ªå‘½æ•£",
        "å¤ªé™½èƒ½æ‰‹é›»ç­’",
        "å¥ªå‘½é¦™é›è…¿",
        "ç™¾ç™¼ç™¾ä¸­æŠ“å¥¶é¾çˆªæ‰‹",
        "é‚„æˆ‘æ¼‚æ¼‚æ‹³",
        "éˆåˆ€æ­¦è¥¿éƒ",
        "éˆ´åˆ€ç°ä¼‘æ¥š",
        "å¸Œå› å¨œ",
        "èƒå“¥",
        "å’–å“©æ¶¼",
        "å¤å¤•å¤æ™¯",
        "æ“ éœ¸æ˜",
        "é¡é˜¿å°–",
        "æ¡ƒæ£’è³½",
        "ç§‹å±±æ›‰",
      ];

      let gameOver = false,
        calledNumbers = new Set(),
        turn = 0,
        participants = [];

      class BingoGame {
        constructor(id, displayName, isPlayer = false) {
          this.id = id;
          this.displayName = displayName; // é€™è£¡å­˜çš„æ˜¯å®Œæ•´æ ¼å¼ï¼Œå¦‚ã€Œç©å®¶:ä½ (ä½¿ç”¨è€…)ã€
          this.isPlayer = isPlayer;
          this.nums = Array.from({ length: 25 }, (_, i) => i + 1).sort(
            () => Math.random() - 0.5,
          );
          this.marked = Array(25).fill(false);
          this.render();
        }
        render() {
          document.getElementById(`title-${this.id}`).innerText =
            this.displayName;
          const boardEl = document.getElementById(`board-${this.id}`);
          boardEl.innerHTML = "";
          this.nums.forEach((num) => {
            const cell = document.createElement("div");
            cell.className = "cell";
            cell.innerText = num;
            if (this.isPlayer) cell.onclick = () => handleTurn(num);
            boardEl.appendChild(cell);
          });
        }
        mark(num) {
          const idx = this.nums.indexOf(num);
          if (idx !== -1) {
            this.marked[idx] = true;
            document
              .getElementById(`board-${this.id}`)
              .children[idx].classList.add("marked");
          }
          return this.calcLines();
        }
        calcLines() {
          let lines = 0,
            m = this.marked;
          for (let i = 0; i < 5; i++) {
            if ([0, 1, 2, 3, 4].every((j) => m[i * 5 + j])) lines++;
            if ([0, 1, 2, 3, 4].every((j) => m[j * 5 + i])) lines++;
          }
          if ([0, 6, 12, 18, 24].every((i) => m[i])) lines++;
          if ([4, 8, 12, 16, 20].every((i) => m[i])) lines++;
          document.getElementById(`status-${this.id}`).innerText =
            `é€£ç·šæ•¸: ${lines}`;
          return lines;
        }
      }

      function resetGame() {
        gameOver = false;
        calledNumbers.clear();
        turn = 0;
        const shuffledNames = [...funnyNames].sort(() => Math.random() - 0.5);

        // è¨­å®šæ‚¨æŒ‡å®šçš„åç¨±æ ¼å¼
        participants = [
          new BingoGame(0, "ç©å®¶:ä½ (ä½¿ç”¨è€…)", true),
          new BingoGame(1, `ç©å®¶:${shuffledNames[0]}(NPC)`),
          new BingoGame(2, `ç©å®¶:${shuffledNames[1]}(NPC)`),
        ];

        setTurn(0);
        document.getElementById("message-box").innerText =
          "ğŸ® é»æ“Šä½ çš„æ•¸å­—é–‹å§‹æ¯”è³½ï¼";
        document.getElementById("message-box").style.background = "#2c3e50";
      }

      async function handleTurn(num) {
        if (gameOver || calledNumbers.has(num) || turn !== 0) return;
        await play(num);
        if (gameOver) return;

        // NPC å›åˆ
        for (let i = 1; i <= 2; i++) {
          setTurn(i);
          await sleep(1000); // ç¨å¾®åŠ é•·ä¸€é»å»¶é²ï¼Œæ›´æœ‰æ¯”è³½æ„Ÿ
          const available = participants[i].nums.filter(
            (n) => !calledNumbers.has(n),
          );
          const npcChoice =
            available[Math.floor(Math.random() * available.length)];
          await play(npcChoice);
          if (gameOver) return;
        }
        setTurn(0);
      }

      async function play(num) {
        calledNumbers.add(num);
        document.getElementById("message-box").innerText =
          `${participants[turn].displayName.split("(")[0]} å–Šäº†ï¼š${num}`;

        let winners = [];
        participants.forEach((p) => {
          if (p.mark(num) >= WIN_LINES) winners.push(p.displayName);
        });

        if (winners.length > 0) {
          gameOver = true;
          document.getElementById("message-box").innerText =
            `ğŸ† è´å®¶ï¼š${winners.join(", ")}`;
          document.getElementById("message-box").style.background = "#27ae60";
        }
      }

      function setTurn(t) {
        turn = t;
        participants.forEach((_, i) => {
          document
            .getElementById(`wrapper-${i}`)
            .classList.toggle("active", i === turn);
        });
        if (turn === 0 && !gameOver) {
          document.getElementById("message-box").innerText =
            "ğŸ® è¼ªåˆ°ä½ äº†ï¼Œè«‹é¸ä¸€å€‹è™Ÿç¢¼ï¼";
        }
      }

      function sleep(ms) {
        return new Promise((r) => setTimeout(r, ms));
      }

      // åˆæ¬¡åŸ·è¡Œ
      resetGame();
    </script>
  </body>
</html>
